{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/front/src/components/Dashboard.js\",\n  _s = $RefreshSig$();\n// src/components/Dashboard.js\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Bar } from 'react-chartjs-2';\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend } from 'chart.js';\nimport '../styles/Dashboard.css';\n\n// Registrar las escalas y elementos\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend);\nconst Dashboard = ({\n  userRole,\n  userEmail\n}) => {\n  _s();\n  const [weeklyData, setWeeklyData] = useState([]);\n  const [filteredData, setFilteredData] = useState([]);\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n  const navigate = useNavigate(); // Hook para redirigir al usuario si el token no es válido\n\n  // Función para obtener los datos del reporte de captura de PET\n  const fetchReportData = useCallback(async () => {\n    const token = localStorage.getItem('token'); // Usa el token de autenticación\n    if (!token) {\n      console.error(\"Token no proporcionado\");\n      navigate('/login'); // Redirige al login si el token no existe\n      return;\n    }\n    try {\n      const response = await fetch('http://54.177.153.3:5000/api/pet/pet-report', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n\n        // Filtrar datos según el rol del usuario\n        if (userRole === 'admin') {\n          setWeeklyData(data);\n        } else {\n          setWeeklyData(data.filter(item => item.user_email === userEmail));\n        }\n        setFilteredData(data); // Por defecto, muestra todos los datos\n      } else if (response.status === 401) {\n        console.error('Error de autenticación: Token no válido');\n        navigate('/login'); // Redirige al login si el token es inválido\n      } else {\n        console.error('Error al obtener los datos del reporte:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Error en la solicitud de datos:', error);\n    }\n  }, [userRole, userEmail, navigate]);\n  useEffect(() => {\n    fetchReportData();\n  }, [fetchReportData]);\n  useEffect(() => {\n    if (startDate && endDate) {\n      const filtered = weeklyData.filter(data => new Date(data.capture_date) >= new Date(startDate) && new Date(data.capture_date) <= new Date(endDate));\n      setFilteredData(filtered);\n    } else {\n      setFilteredData(weeklyData);\n    }\n  }, [startDate, endDate, weeklyData]);\n\n  // Configuración de datos para el gráfico\n  const chartData = {\n    labels: filteredData.map(data => new Date(data.capture_date).toLocaleDateString()),\n    datasets: [{\n      label: 'Peso de PET recolectado (kg)',\n      data: filteredData.map(data => data.weight_kg),\n      backgroundColor: 'rgba(75, 192, 192, 0.6)'\n    }, {\n      label: 'Precio en USD',\n      data: filteredData.map(data => data.price_usd),\n      backgroundColor: 'rgba(54, 162, 235, 0.6)'\n    }, {\n      label: 'Precio en MXN',\n      data: filteredData.map(data => data.price_mxn),\n      backgroundColor: 'rgba(255, 206, 86, 0.6)'\n    }]\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"dashboard-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"dashboard-title\",\n      children: \"Resumen de Captura Semanal de PET\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"filters\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Fecha de inicio:\", /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"date\",\n          value: startDate,\n          onChange: e => setStartDate(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Fecha de fin:\", /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"date\",\n          value: endDate,\n          onChange: e => setEndDate(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chart-container\",\n      children: /*#__PURE__*/_jsxDEV(Bar, {\n        data: chartData,\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              position: 'top'\n            }\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 5\n  }, this);\n};\n_s(Dashboard, \"bvVIjFHq69CbT+YYHXEDQNoZRYc=\", false, function () {\n  return [useNavigate];\n});\n_c = Dashboard;\nexport default Dashboard;\nvar _c;\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useNavigate","Bar","Chart","ChartJS","CategoryScale","LinearScale","BarElement","Title","Tooltip","Legend","jsxDEV","_jsxDEV","register","Dashboard","userRole","userEmail","_s","weeklyData","setWeeklyData","filteredData","setFilteredData","startDate","setStartDate","endDate","setEndDate","navigate","fetchReportData","token","localStorage","getItem","console","error","response","fetch","headers","ok","data","json","filter","item","user_email","status","statusText","filtered","Date","capture_date","chartData","labels","map","toLocaleDateString","datasets","label","weight_kg","backgroundColor","price_usd","price_mxn","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","value","onChange","e","target","options","responsive","plugins","legend","position","_c","$RefreshReg$"],"sources":["/home/ubuntu/front/src/components/Dashboard.js"],"sourcesContent":["// src/components/Dashboard.js\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Bar } from 'react-chartjs-2';\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend,\n} from 'chart.js';\nimport '../styles/Dashboard.css';\n\n// Registrar las escalas y elementos\nChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend);\n\nconst Dashboard = ({ userRole, userEmail }) => {\n  const [weeklyData, setWeeklyData] = useState([]);\n  const [filteredData, setFilteredData] = useState([]);\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n  const navigate = useNavigate(); // Hook para redirigir al usuario si el token no es válido\n\n  // Función para obtener los datos del reporte de captura de PET\n  const fetchReportData = useCallback(async () => {\n    const token = localStorage.getItem('token'); // Usa el token de autenticación\n    if (!token) {\n      console.error(\"Token no proporcionado\");\n      navigate('/login'); // Redirige al login si el token no existe\n      return;\n    }\n\n    try {\n      const response = await fetch('http://54.177.153.3:5000/api/pet/pet-report', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json',\n        }\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n\n        // Filtrar datos según el rol del usuario\n        if (userRole === 'admin') {\n          setWeeklyData(data);\n        } else {\n          setWeeklyData(data.filter(item => item.user_email === userEmail));\n        }\n        setFilteredData(data); // Por defecto, muestra todos los datos\n      } else if (response.status === 401) {\n        console.error('Error de autenticación: Token no válido');\n        navigate('/login'); // Redirige al login si el token es inválido\n      } else {\n        console.error('Error al obtener los datos del reporte:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Error en la solicitud de datos:', error);\n    }\n  }, [userRole, userEmail, navigate]);\n\n  useEffect(() => {\n    fetchReportData();\n  }, [fetchReportData]);\n\n  useEffect(() => {\n    if (startDate && endDate) {\n      const filtered = weeklyData.filter((data) =>\n        new Date(data.capture_date) >= new Date(startDate) &&\n        new Date(data.capture_date) <= new Date(endDate)\n      );\n      setFilteredData(filtered);\n    } else {\n      setFilteredData(weeklyData);\n    }\n  }, [startDate, endDate, weeklyData]);\n\n  // Configuración de datos para el gráfico\n  const chartData = {\n    labels: filteredData.map(data => new Date(data.capture_date).toLocaleDateString()),\n    datasets: [\n      {\n        label: 'Peso de PET recolectado (kg)',\n        data: filteredData.map(data => data.weight_kg),\n        backgroundColor: 'rgba(75, 192, 192, 0.6)',\n      },\n      {\n        label: 'Precio en USD',\n        data: filteredData.map(data => data.price_usd),\n        backgroundColor: 'rgba(54, 162, 235, 0.6)',\n      },\n      {\n        label: 'Precio en MXN',\n        data: filteredData.map(data => data.price_mxn),\n        backgroundColor: 'rgba(255, 206, 86, 0.6)',\n      },\n    ],\n  };\n\n  return (\n    <div className=\"dashboard-container\">\n      <h2 className=\"dashboard-title\">Resumen de Captura Semanal de PET</h2>\n      <div className=\"filters\">\n        <label>\n          Fecha de inicio:\n          <input type=\"date\" value={startDate} onChange={(e) => setStartDate(e.target.value)} />\n        </label>\n        <label>\n          Fecha de fin:\n          <input type=\"date\" value={endDate} onChange={(e) => setEndDate(e.target.value)} />\n        </label>\n      </div>\n      <div className=\"chart-container\">\n        <Bar data={chartData} options={{ responsive: true, plugins: { legend: { position: 'top' } } }} />\n      </div>\n    </div>\n  );\n};\n\nexport default Dashboard;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}