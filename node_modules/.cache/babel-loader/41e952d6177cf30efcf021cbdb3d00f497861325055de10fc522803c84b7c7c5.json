{"ast":null,"code":"// src/components/Dashboard.js\nimport React,{useState,useEffect,useCallback}from'react';import{Bar}from'react-chartjs-2';import{Chart as ChartJS,CategoryScale,LinearScale,BarElement,Title,Tooltip,Legend}from'chart.js';import'../styles/Dashboard.css';// Registrar las escalas y elementos\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,BarElement,Title,Tooltip,Legend);const Dashboard=_ref=>{let{userRole,userEmail}=_ref;const[weeklyData,setWeeklyData]=useState([]);const[filteredData,setFilteredData]=useState([]);const[startDate,setStartDate]=useState('');const[endDate,setEndDate]=useState('');// Función para obtener los datos del reporte de captura de PET\nconst fetchReportData=useCallback(async()=>{try{const token=localStorage.getItem('token');// Usa el token de autenticación\nconst response=await fetch('http://54.177.153.3:5000/api/pet/pet-report',{headers:{'Authorization':`Bearer ${token}`}});if(response.ok){const data=await response.json();// Filtrar datos según el rol del usuario\nif(userRole==='admin'){setWeeklyData(data);}else{setWeeklyData(data.filter(item=>item.user_email===userEmail));}setFilteredData(data);// Por defecto, muestra todos los datos\n}else{console.error('Error al obtener los datos del reporte:',response.statusText);}}catch(error){console.error('Error en la solicitud de datos:',error);}},[userRole,userEmail]);useEffect(()=>{fetchReportData();},[fetchReportData]);useEffect(()=>{if(startDate&&endDate){const filtered=weeklyData.filter(data=>new Date(data.capture_date)>=new Date(startDate)&&new Date(data.capture_date)<=new Date(endDate));setFilteredData(filtered);}else{setFilteredData(weeklyData);}},[startDate,endDate,weeklyData]);// Configuración de datos para el gráfico\nconst chartData={labels:filteredData.map(data=>new Date(data.capture_date).toLocaleDateString()),datasets:[{label:'Peso de PET recolectado (kg)',data:filteredData.map(data=>data.weight_kg),backgroundColor:'rgba(75, 192, 192, 0.6)'},{label:'Precio en USD',data:filteredData.map(data=>data.price_usd),backgroundColor:'rgba(54, 162, 235, 0.6)'},{label:'Precio en MXN',data:filteredData.map(data=>data.price_mxn),backgroundColor:'rgba(255, 206, 86, 0.6)'}]};return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"dashboard-title\",children:\"Resumen de Captura Semanal de PET\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Fecha de inicio:\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:startDate,onChange:e=>setStartDate(e.target.value)})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Fecha de fin:\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:endDate,onChange:e=>setEndDate(e.target.value)})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chart-container\",children:/*#__PURE__*/_jsx(Bar,{data:chartData,options:{responsive:true,plugins:{legend:{position:'top'}}}})})]});};export default Dashboard;","map":{"version":3,"names":["React","useState","useEffect","useCallback","Bar","Chart","ChartJS","CategoryScale","LinearScale","BarElement","Title","Tooltip","Legend","jsx","_jsx","jsxs","_jsxs","register","Dashboard","_ref","userRole","userEmail","weeklyData","setWeeklyData","filteredData","setFilteredData","startDate","setStartDate","endDate","setEndDate","fetchReportData","token","localStorage","getItem","response","fetch","headers","ok","data","json","filter","item","user_email","console","error","statusText","filtered","Date","capture_date","chartData","labels","map","toLocaleDateString","datasets","label","weight_kg","backgroundColor","price_usd","price_mxn","className","children","type","value","onChange","e","target","options","responsive","plugins","legend","position"],"sources":["/home/ubuntu/front/src/components/Dashboard.js"],"sourcesContent":["// src/components/Dashboard.js\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Bar } from 'react-chartjs-2';\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  BarElement,\n  Title,\n  Tooltip,\n  Legend,\n} from 'chart.js';\nimport '../styles/Dashboard.css';\n\n// Registrar las escalas y elementos\nChartJS.register(CategoryScale, LinearScale, BarElement, Title, Tooltip, Legend);\n\nconst Dashboard = ({ userRole, userEmail }) => {\n  const [weeklyData, setWeeklyData] = useState([]);\n  const [filteredData, setFilteredData] = useState([]);\n  const [startDate, setStartDate] = useState('');\n  const [endDate, setEndDate] = useState('');\n\n  // Función para obtener los datos del reporte de captura de PET\n  const fetchReportData = useCallback(async () => {\n    try {\n      const token = localStorage.getItem('token'); // Usa el token de autenticación\n      const response = await fetch('http://54.177.153.3:5000/api/pet/pet-report', {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n\n        // Filtrar datos según el rol del usuario\n        if (userRole === 'admin') {\n          setWeeklyData(data);\n        } else {\n          setWeeklyData(data.filter(item => item.user_email === userEmail));\n        }\n        setFilteredData(data); // Por defecto, muestra todos los datos\n      } else {\n        console.error('Error al obtener los datos del reporte:', response.statusText);\n      }\n    } catch (error) {\n      console.error('Error en la solicitud de datos:', error);\n    }\n  }, [userRole, userEmail]);\n\n  useEffect(() => {\n    fetchReportData();\n  }, [fetchReportData]);\n\n  useEffect(() => {\n    if (startDate && endDate) {\n      const filtered = weeklyData.filter((data) =>\n        new Date(data.capture_date) >= new Date(startDate) &&\n        new Date(data.capture_date) <= new Date(endDate)\n      );\n      setFilteredData(filtered);\n    } else {\n      setFilteredData(weeklyData);\n    }\n  }, [startDate, endDate, weeklyData]);\n\n  // Configuración de datos para el gráfico\n  const chartData = {\n    labels: filteredData.map(data => new Date(data.capture_date).toLocaleDateString()),\n    datasets: [\n      {\n        label: 'Peso de PET recolectado (kg)',\n        data: filteredData.map(data => data.weight_kg),\n        backgroundColor: 'rgba(75, 192, 192, 0.6)',\n      },\n      {\n        label: 'Precio en USD',\n        data: filteredData.map(data => data.price_usd),\n        backgroundColor: 'rgba(54, 162, 235, 0.6)',\n      },\n      {\n        label: 'Precio en MXN',\n        data: filteredData.map(data => data.price_mxn),\n        backgroundColor: 'rgba(255, 206, 86, 0.6)',\n      },\n    ],\n  };\n\n  return (\n    <div className=\"dashboard-container\">\n      <h2 className=\"dashboard-title\">Resumen de Captura Semanal de PET</h2>\n      <div className=\"filters\">\n        <label>\n          Fecha de inicio:\n          <input type=\"date\" value={startDate} onChange={(e) => setStartDate(e.target.value)} />\n        </label>\n        <label>\n          Fecha de fin:\n          <input type=\"date\" value={endDate} onChange={(e) => setEndDate(e.target.value)} />\n        </label>\n      </div>\n      <div className=\"chart-container\">\n        <Bar data={chartData} options={{ responsive: true, plugins: { legend: { position: 'top' } } }} />\n      </div>\n    </div>\n  );\n};\n\nexport default Dashboard;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}